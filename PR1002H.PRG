*** PARTIDAS Y SUS SUBPARTIDAS X PROGRAMAS Y SUS ACTIVIDADES EXTENDIDO
SELECT 1
USE PRCTAS INDEX PRCTAS4
SELECT 2
USE PRUNID INDEX PRUNID
SELECT 1
DO WHILE .T.
   @ 15,55 CLEAR TO 22,76
   @ 15,55 to 22,76
   @ 16,56 say "A¥O     :"
   @ 17,56 say "TIPO    :"
   @ 18,56 say "ORIGEN  :"
   @ 19,56 SAY "SECTOR  :"
   @ 20,56 SAY "PROGRAMA:"
   @ 21,56 SAY "COM/EXT :"
   @ 16,66 GET WPREANO
   @ 17,66 GET WPRETIP
   @ 18,66 GET WPREORI
   @ 19,66 GET WSECTOR
   @ 20,66 GET WPROGRA
   READ
   IF READKEY() = 12 .OR. READKEY() = 268
      EXIT
   ENDIF
   IF WPREANO=SPACE(2).OR.;
      WPRETIP=SPACE(2).OR.;
      WPREORI=SPACE(3).OR.;
      WSECTOR=SPACE(2).OR.;
      WPROGRA=SPACE(2)
      STORE "SELECCION DE CODIGOS INCOMPLETA, REINTENTE" TO MES
      DO AVISO WITH MES
      LOOP
   ENDIF
   STORE "TIPO DE DESCRIPCION: (C)OMPRIMIDA, (E)XPANDIDA" TO TEX
   STORE "CE" TO WCH
   DO PREGUNTA
   STORE WCH TO WMODELO
   IF WMODELO="C"
      @ 21,66 SAY "COM"
      STORE 0   TO WFILLER
   ELSE
      @ 21,66 SAY "EXP"
      STORE 44  TO WFILLER
   ENDIF
   STORE "SELECCIONE : (C)ONTINUAR, (S)ALIR" TO TEX
   STORE "CS" TO WCH
   DO PREGUNTA
   IF WCH = "S"
      EXIT
   ENDIF
   *** DATOS DEL SECTOR
   STORE WPREANO+WPRETIP+WPREORI+WSECTOR+SPACE(19) TO WCLAVE
   SEEK WCLAVE
   IF .NOT. FOUND()
      STORE "LA SELECCION DE CODIGOS DEL PLAN DE CUENTAS NO EXISTE. OPRIMA <ENTER>" TO MES
      DO AVISO WITH MES
      LOOP
   ENDIF
   STORE DESCRI1   TO WDESSEC1
   STORE DESCRI2   TO WDESSEC2
   STORE DESCRI3   TO WDESSEC3
   STORE DESCRI4   TO WDESSEC4
   *** DATOS DEL PROGRAMA
   STORE WPREANO+WPRETIP+WPREORI+WSECTOR+WPROGRA+SPACE(17) TO WCLAVE
   SEEK WCLAVE
   IF .NOT. FOUND()
      STORE "LA SELECCION DE CODIGOS DEL PLAN DE CUENTAS NO EXISTE. OPRIMA <ENTER>" TO MES
      DO AVISO WITH MES
      LOOP
   ENDIF
   STORE DESCRI1  TO WDESPRO1
   STORE DESCRI2  TO WDESPRO2
   STORE DESCRI3  TO WDESPRO3
   STORE DESCRI4  TO WDESPRO4
   STORE SPACE(11)  TO WRUPPARTID
   SELECT 2
   SEEK PRCTAS->UNIEJE
   IF FOUND()
      STORE DESCRI          TO WDESUNID
   ELSE
      STORE "NO REGISTRADO" TO WDESUNID
   ENDIF
   SET DEVI       TO PRINT
   STORE 40       TO FINAL
   STORE 100      TO WLINE
   STORE 0        TO WPAGE
   STORE 0        TO WCONACT
   STORE .T.      TO WFLAGCONACT
   STORE .F. TO WFLAGMONTO
   DIME  PROACT(3,20)
   DO LIMPAR
   DO LIMFIN
   STORE SPACE(0) TO WCADENA
   SELECT PRCTAS
   DO WHILE .NOT. EOF()
      IF PREANO<>WPREANO.OR.;
         PRETIP<>WPRETIP.OR.;
         PREORI<>WPREORI.OR.;
         SECTOR<>WSECTOR.OR.;
         PROGRA<>WPROGRA
         EXIT
      ENDIF
      IF WFLAGCONACT
         ***  CONTADOR DE ACTIVIDADES  (PROYECTOS Y ACTIVIDADES)
         ***  PARA EL ARREGLO DE ACTIVIDADES DEL PROGRAMA
         IF PARTID=SPACE(4).AND.ACTIVI<>SPACE(2).AND.ACTIVI<>"00"
            STORE WCONACT+1 TO WCONACT
            STORE ACTIVI    TO PROACT(1,WCONACT)
         ENDIF
      ENDIF
      **** SOLO PARA QUE SE PARESCA EL QUE USAN  (ELIMINAR SI SUBPRO O PROYEC <> 0)
      IF SUBPRO<>"  ".AND.PROYEC="  "
         SELECT PRCTAS
         SKIP
         LOOP
      ENDIF
      IF PROGRA<>"  ".AND.SUBPRO="  "
         SELECT PRCTAS
         SKIP
         LOOP
      ENDIF
      IF PROYEC<>"  ".AND.ACTIVI="  "
         SELECT PRCTAS
         SKIP
         LOOP
      ENDIF
      IF ACTIVI<>"  ".AND.PARTID="    "
         SELECT PRCTAS
         SKIP
         LOOP
      ENDIF
      ****
      STORE PARTID+GENERI+ESPECI+SUBESP+ORDINA TO WCODPAR
      IF WCODPAR<>WRUPPARTID
         DO LINPAR
         STORE WCODPAR TO WRUPPARTID
         STORE DESCRI1 TO WDESPAR1
         STORE DESCRI2 TO WDESPAR2
         STORE DESCRI3 TO WDESPAR3
         STORE DESCRI4 TO WDESPAR4
         DO LIMPAR
      ENDIF
      IF ORIG>0
         STORE .T. TO WFLAGMONTO
      ENDIF
      DO ACUPAR
      IF ORDINA<>SPACE(3)
         DO ACUFIN
      ENDIF
      SELECT PRCTAS
      SKIP
   ENDDO
   DO LINPAR
   DO LINTOT
   SET DEVI TO SCRE
   EJECT
ENDDO
CLOSE DATA
CLOSE INDEX
RETURN
*************
PROC LIMPAR
*************
*** LIMPIA ARREGLO EN VALORES X PARTIDA
STORE .F. TO WFLAGMONTO
STORE 1 TO WCON
DO WHILE WCON<=20
   STORE 0 TO PROACT(2,WCON)
   STORE WCON+1 TO WCON
ENDDO
RETURN
***************
PROC LIMFIN
***************
*** LIMPIA ARREGLO EN VALORES TOTALES
STORE .F. TO WFLAGMONTO
STORE 1 TO WCON
DO WHILE WCON<=20
   STORE 0 TO PROACT(3,WCON)
   STORE WCON+1 TO WCON
ENDDO
RETURN
***************
PROC PROCTITU
***************
STORE .F.       TO WFLAGCONACT
STORE WPAGE + 1 TO WPAGE
IF WPAGE <> 1 .AND. WLINE<100
   DO LINEXT
ENDIF
@ 00,00 SAY CHR(18)
@ 00,05 say "CREDITOS PRESUPUESTARIOS DEL PROGRAMA Y SUS ACTIVIDADES"
@ 01,05 say "    A NIVEL DE PARTIDAS Y SUB-PARTIDAS ESPECIFICAS     "
@ 02,00 SAY CHR(15)
@ 03,00 SAY "PRESUPUESTO     : "+WPREANO+"  "+WPRETIP
@ 04,00 SAY "SECTOR          : "+WSECTOR+" "+RTRIM(WDESSEC1)+" "+RTRIM(WDESSEC2)+" "+RTRIM(WDESSEC3)+" "+RTRIM(WDESSEC4)
@ 05,00 SAY "PROGRAMA        : "+WPROGRA+" "+RTRIM(WDESPRO1)+" "+RTRIM(WDESPRO2)+" "+RTRIM(WDESPRO3)+" "+RTRIM(WDESPRO4)
@ 06,00 SAY "UNIDAD EJECUTORA: "+WDESUNID
STORE 07 TO WLINE
DO LINEXT
STORE 08 TO WLINE
DO LININTADD
@ WLINE,00 SAY "|  P  |G |E |S |O  |                                              "+REPLICATE(" ",WFILLER)+"|                  |"+WCADENA
STORE 09 TO WLINE
DO LININTACT
@ WLINE,00 SAY "|  A  |E |S |E |R  |D E N O M I N A C I O N                       "+REPLICATE(" ",WFILLER)+"|    TOTAL PROGRAMA|"+WCADENA
STORE 10 TO WLINE
DO LININTADD
@ WLINE,00 SAY "|  R  |N |P |S |D  |                                              "+REPLICATE(" ",WFILLER)+"|                  |"+WCADENA
STORE 11 TO WLINE
DO LINEXT
STORE 12 TO WLINE
RETURN
***********
PROC LININT
***********
DO LININTADD
@ WLINE,00 SAY "|     |  |  |  |   |                                              "+REPLICATE(" ",WFILLER)+"|                  |"+WCADENA
RETURN
**************
PROC LININTADD
**************
STORE SPACE(0) TO WCADENA
STORE 1 TO WCON
DO WHILE WCON<=WCONACT
   STORE WCADENA+REPLICATE(" ",18)+"|" TO WCADENA
   STORE WCON+1 TO WCON
ENDDO
RETURN
***********
PROC LINEXT
***********
DO LINEXTADD
@ WLINE,00 SAY "+-----+--+--+--+---+----------------------------------------------"+REPLICATE("-",WFILLER)+"+------------------+"+WCADENA
RETURN
**************
PROC LINEXTADD
**************
STORE SPACE(0) TO WCADENA
STORE 1 TO WCON
DO WHILE WCON<=WCONACT
   STORE WCADENA+REPLICATE("-",18)+"+" TO WCADENA
   STORE WCON+1 TO WCON
ENDDO
RETURN
**************
PROC LININTACT
**************
STORE SPACE(0) TO WCADENA
STORE 1 TO WCON
DO WHILE WCON<=WCONACT
   IF PROACT(1,WCON)>="50"
      STORE "      ACTIVIDAD " TO WSTRING
   ELSE
      STORE "       PROYECTO " TO WSTRING
   ENDIF
   STORE WCADENA+WSTRING+PROACT(1,WCON)+"|" TO WCADENA
   STORE WCON+1 TO WCON
ENDDO
RETURN
**************
PROC LINPAR
**************
IF .NOT. WFLAGMONTO
   RETURN
ENDIF
STORE WLINE+1 TO WLINE
IF WLINE > FINAL
   DO PROCTITU
ENDIF
DO LININT

IF SUBSTR(WRUPPARTID,01,4)<>"00"
   @ WLINE,001 SAY SUBSTR(WRUPPARTID,01,4)
ENDIF
IF SUBSTR(WRUPPARTID,05,2)<>"00"
   @ WLINE,007 SAY SUBSTR(WRUPPARTID,05,2)
ENDIF
IF SUBSTR(WRUPPARTID,07,2)<>"00"
   @ WLINE,010 SAY SUBSTR(WRUPPARTID,07,2)
ENDIF
IF SUBSTR(WRUPPARTID,09,2)<>"00"
   @ WLINE,013 SAY SUBSTR(WRUPPARTID,09,2)
ENDIF
IF SUBSTR(WRUPPARTID,11,3)<>"000"
   @ WLINE,016 SAY SUBSTR(WRUPPARTID,11,3)
ENDIF
IF WFILLER>0
   @ WLINE,020 SAY RTRIM(WDESPAR1)+" "+RTRIM(WDESPAR2)
ELSE
   @ WLINE,020 SAY RTRIM(WDESPAR1)
ENDIF
***
STORE 0 TO WTOTPAR
STORE 1 TO WCON
DO WHILE WCON<=WCONACT
   STORE WTOTPAR+PROACT(2,WCON) TO WTOTPAR
   STORE WCON+1 TO WCON
ENDDO
@ WLINE,067+WFILLER SAY WTOTPAR  PICTURE "@Z ###,###,###,###.##"
***
STORE 1 TO WCON
DO WHILE WCON<=WCONACT
   @ WLINE,085+WFILLER+(19*(WCON-1)) SAY PROACT(2,WCON) PICTURE "@Z ###,###,###,###.##"
   STORE WCON+1 TO WCON
ENDDO
IF WFILLER>0
   IF WDESPAR3<>SPACE(44).OR.WDESPAR4<>SPACE(44)
      STORE WLINE+1 TO WLINE
      DO LININT
      @ WLINE,20 SAY RTRIM(WDESPAR3)+" "+RTRIM(WDESPAR4)
   ENDIF
ELSE
   IF WDESPAR2<>SPACE(44)
      STORE WLINE+1 TO WLINE
      DO LININT
      @ WLINE,20 SAY WDESPAR2
   ENDIF
   IF WDESPAR3<>SPACE(44)
      STORE WLINE+1 TO WLINE
      DO LININT
      @ WLINE,20 SAY WDESPAR3
   ENDIF
   IF WDESPAR4<>SPACE(44)
      STORE WLINE+1 TO WLINE
      DO LININT
      @ WLINE,20 SAY WDESPAR4
   ENDIF
   STORE WLINE+1 TO WLINE
   DO LININT
ENDIF
RETURN
***********
PROC LINTOT
***********
STORE 0 TO WTOTGEN
STORE 1 TO WCON
DO WHILE WCON<=WCONACT
   STORE WTOTGEN+PROACT(3,WCON) TO WTOTGEN
   STORE WCON+1 TO WCON
ENDDO
STORE WLINE+1 TO WLINE
DO LINEXT
STORE WLINE+1 TO WLINE
DO LININT
@ WLINE,20  SAY "T O T A L E S ......"
@ WLINE,067+WFILLER SAY WTOTGEN  PICTURE "@Z ###,###,###,###.##"
***
STORE 1 TO WCON
DO WHILE WCON<=WCONACT
   @ WLINE,085+WFILLER+(19*(WCON-1)) SAY PROACT(3,WCON) PICTURE "@Z ###,###,###,###.##"
   STORE WCON+1 TO WCON
ENDDO
STORE WLINE+1 TO WLINE
DO LINEXT
RETURN
************
PROC ACUPAR
************
*** ACUMULA ARREGLO EN VALORES X PARTIDA
STORE .T. TO WFLAGALERT
STORE 1 TO WCON
DO WHILE WCON<=WCONACT
   IF PROACT(1,WCON)=ACTIVI
      STORE ORIG TO PROACT(2,WCON)
      STORE .F.  TO WFLAGALERT
   ENDIF
   STORE WCON+1 TO WCON
ENDDO
IF WFLAGALERT
   SET DEVI TO SCRE
   STORE "ERROR INTERNO, NO SE ENCONTRO LA ACTIVIDAD "+ACTIVI+" EN EN ARREGLO" TO MES
   DO AVISO WITH MES
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
RETURN
*************
PROC ACUFIN
*************
*** ACUMULA ARREGLO EN MONTO FINAL
STORE 1 TO WCON
DO WHILE WCON<=WCONACT
   IF PROACT(1,WCON)=ACTIVI
      STORE PROACT(3,WCON)+ORIG TO PROACT(3,WCON)
   ENDIF
   STORE WCON+1 TO WCON
ENDDO
RETURN
